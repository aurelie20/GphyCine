
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import javax.faces.application.FacesMessage;
import javax.faces.bean.ManagedBean;
import javax.faces.context.FacesContext;

/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
/**
 *
 * @author William
 */
@ManagedBean
public class Admin_modif_Exploit {

    private ArrayList<String> titreF = null;
    private String choixFilm;
    private ArrayList<String> titreF2 = null;
    private String choixFilm2;

    public void info3(String message) {
        FacesMessage test = new FacesMessage(FacesMessage.SEVERITY_INFO, message, null);
        FacesContext.getCurrentInstance().addMessage("Information", test);
    }

    public ArrayList<String> getTitreF2() throws ClassNotFoundException {
        filmAff2();
        return titreF2;
    }

    public void setTitreF2(ArrayList<String> titreF2) {
        this.titreF2 = titreF2;
    }

    public String getChoixFilm2() {
        return choixFilm2;
    }

    public void setChoixFilm2(String choixFilm2) {
        this.choixFilm2 = choixFilm2;
    }

    public ArrayList<String> getTitreF() throws ClassNotFoundException {
        filmAff();
        return titreF;
    }

    public void setTitreF(ArrayList<String> titreF) {
        this.titreF = titreF;
    }

    public String getChoixFilm() {
        return choixFilm;
    }

    public void setChoixFilm(String choixFilm) {
        this.choixFilm = choixFilm;
    }

    public void filmAff() throws ClassNotFoundException {
        Connection conn = null;
        Statement stmt = null;
        ResultSet rs = null;

        try {
            Class.forName("com.mysql.jdbc.Driver");
            conn = DriverManager.getConnection("jdbc:mysql://localhost/gphy_cine", "root", "");

            //Connexion reussie
            stmt = conn.createStatement();
            rs = stmt.executeQuery("SELECT titre FROM film where en_exploitation=0");

            System.out.println("OK retourne film");
            titreF = new ArrayList<String>();
            while (rs.next()) {
                titreF.add(rs.getString("titre"));
            }
        } catch (SQLException ex) {
            System.out.println("SQLException:" + ex.getMessage());
        } finally {
            if (rs != null) {
                try {
                    rs.close();
                } catch (SQLException sqlEx) {
                    //ignore
                    System.out.println("pas de rep");
                }
                rs = null;
            }
            if (stmt != null) {
                try {
                    stmt.close();
                } catch (SQLException sqlEx) {
                    System.out.println("pas de stmt");
                }
                stmt = null;
            }
            if (conn != null) {
                try {
                    conn.close();
                } catch (SQLException sqlEx) {
                    System.out.println("pas de conn");
                }
                conn = null;
            }
        }
    }

    public void enExploitFilm() throws ClassNotFoundException {
        Connection conn = null;
        Statement stmt = null;
        ResultSet rs = null;

        try {
            System.out.println("je modif");
            Class.forName("com.mysql.jdbc.Driver");
            conn = DriverManager.getConnection("jdbc:mysql://localhost/gphy_cine", "root", "");
            // connection réussie
            stmt = conn.createStatement();
            stmt.executeUpdate("update film set en_exploitation = 1 where titre =" + "'" + choixFilm + "'");
            info3("Le film est en exploitation");

        } catch (SQLException ex) {
            System.out.println("SQLException:" + ex.getMessage());

        } finally {
            if (rs != null) {
                System.out.print("");
                System.out.println("pas de rep");
            }

        }
    }

    public void filmAff2() throws ClassNotFoundException {
        Connection conn = null;
        Statement stmt = null;
        ResultSet rs = null;

        try {
            Class.forName("com.mysql.jdbc.Driver");
            conn = DriverManager.getConnection("jdbc:mysql://localhost/gphy_cine", "root", "");

            //Connexion reussie
            stmt = conn.createStatement();
            rs = stmt.executeQuery("SELECT titre FROM film where en_exploitation=1");

            System.out.println("OK retourne film");
            titreF2 = new ArrayList<String>();
            while (rs.next()) {
                titreF2.add(rs.getString("titre"));
            }
        } catch (SQLException ex) {
            System.out.println("SQLException:" + ex.getMessage());
        } finally {
            if (rs != null) {
                try {
                    rs.close();
                } catch (SQLException sqlEx) {
                    //ignore
                    System.out.println("pas de rep");
                }
                rs = null;
            }
            if (stmt != null) {
                try {
                    stmt.close();
                } catch (SQLException sqlEx) {
                    System.out.println("pas de stmt");
                }
                stmt = null;
            }
            if (conn != null) {
                try {
                    conn.close();
                } catch (SQLException sqlEx) {
                    System.out.println("pas de conn");
                }
                conn = null;
            }
        }
    }

    public void enExploitFilm2() throws ClassNotFoundException {
        Connection conn = null;
        Statement stmt = null;
        ResultSet rs = null;

        try {
            System.out.println("je modif");
            Class.forName("com.mysql.jdbc.Driver");
            conn = DriverManager.getConnection("jdbc:mysql://localhost/gphy_cine", "root", "");
            // connection réussie
            stmt = conn.createStatement();
            stmt.executeUpdate("update film set en_exploitation = 0 where titre =" + "'" + choixFilm2 + "'");
            info3("Le film n'est plus en exploitation");

        } catch (SQLException ex) {
            System.out.println("SQLException:" + ex.getMessage());

        } finally {
            if (rs != null) {
                System.out.print("");
                System.out.println("pas de rep");
            }

        }
    }
}
